!DOCTYPE html>

<html lang="en">
<meta charset="UTF-8">

<head>


  <link rel='stylesheet' href='stock.css'>

</head>

<body>


   <input type='text'placeholder="Search...">
    <button id='deletebutton'>+</button>
  <i class="fa fa-search" id='searchicon'></i>
<div id='parent_of_canvas'>
    <div class='loader'></div>
  <canvas id="chart"></canvas>
   </div>

    <div id='info_price'></div>
    <div id='info_date'></div>
    <div id='customToolTip'></div>
    <div id='price'>

      <span id='dollar'><span class='small_loader' style='position: absolute;left: 15%'></span></span>
      <span id='percent'></span><br>
    </div>
    </div>
    <div id='range'>
      <button id='one_day'>1D</button>
      <button id='one_week'>1W</button>
      <button id='one_month'>1M</button>
       <button id='two_month'>2M</button>
       <button id='three_month'>3M</button>
        <button id='six_month'>6M</button>
        <button id='one_year'>1Y</button>
        <button id='two_year'>2Y</button>
        <button id='five_year'>5Y</button>
        <button id='ten_year'>10Y</button>

      <button id='all_time'>All</button>
    </div>

<script src="https://use.fontawesome.com/523d8f4491.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
<!-- Chrome doesn't allow use web webworker from local file, this I have to use a script and blob to set the web worker. But after I build up the web sever, it could be put in a separate file to increase code readbility -->
<script id='web_worker_one' type='javascript/worker'>



self.onmessage = function(e) {
  start_fetching_data(e.data).then(function(result){
    const full_data = result
      self.postMessage(JSON.stringify(result))

  });
    self.postMessage('msg from worker');
  };


function start_fetching_data(symbol){
  return fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol.toUpperCase()}&outputsize=full&apikey=FXLQF9OPEP8ROBMD`)
  .then(res=> res.json())
  .then(data =>{
   const all_data =data["Time Series (Daily)"]    
    
    const organized_data = []
    //ES2020 adds the feature of Intl.NumberFormat() constructor, we could use Intl.NumberFormat() constructor here to format the large number properly (e.g. 1000 => 1k)
    const formatter = Intl.NumberFormat('en', { notation: 'compact' })
 Object.keys(all_data).forEach((info,index)=>{
      organized_data.push({
        "date":info,
        "price":parseInt(all_data[info]["4. close"]),
         "volume":formatter.format(all_data[info]["5. volume"])
      })
       
     })
     
      return organized_data.sort(({
      date: a
    }, {
      date: b
    }) => a < b ? -1 : (a > b ? 1 : 0));
  

    })
  
}

</script>
 
<script src='stock.js'></script>

</body>

</html>



